name: "Cache Docker images"

on:
  workflow_dispatch:

jobs:
  cache-images:
    runs-on: "ubuntu-latest"
    steps:
      - name: "Check out sources"
        id: "checkout"
        uses: "actions/checkout@v3"

      - name: "Setup image cache"
        id: "cache"
        uses: "actions/cache@v3"
        with:
          path: "cache"
          key: "docker-${{ runner.os }}-${{ runner.arch }}"

      - name: "Restore image cache"
        run: |
          bash -x ./restore.sh

      - name: "Do things in container"
        run: |
          set -euo pipefail

          docker run --rm -i --name "testing" registry.access.redhat.com/ubi9:9.2 cat /etc/os-release

      - name: "Cache images"
        run: |
          bash -x ./cache.sh
